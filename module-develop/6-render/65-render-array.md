# 6.5 渲染数组

渲染数组或者可渲染数组用于渲染Drupal页面。渲染数组是一个关联数组，它符合Drupal渲染API规定的标准数据结构。渲染API与主题API集成在一起。

在许多情况，用于建立页面或其中一部份的数据一直保持为结构化的数组，直到最后一步生成一个响应。这提供了扩展，轻微更改或完全覆盖页面部分的巨大灵活性。

渲染阵列是嵌套的，因此形成一个树。考虑他们Drupal的“渲染树” - Drupal相当于DOM。

注意:渲染数组与被表单API使用的数组共享一些元素、属性和结构，有很多表单元素的属性对表单API是有意义的，但对渲染API却是无意义的。表单API数组通过FormBuilder方法转换为渲染数组，直接将表单数组传给渲染API可能会导致一个不可预知的错误。

### 什么是“渲染”?

渲染在Drupal中是指将结构化的渲染数组转换成HTML。请阅读HTML主要内容渲染一节。

### 什么是渲染数组?

渲染数组是一个结构化的数组，它提供渲染的数据并带有一些属性以指出怎样渲染\(属性如\#type\)。一个页面数组看起来像:

```php
$page = [
  '#type' => 'page',
  'content' => [
    'system_main' => […],
    'another_block' => […],
    '#sorted' => TRUE,
  ],
  'sidebar_first' => [
    …
  ],
];
```

在Drupal 7中，表单可以使用hook\_form\_alter\(\)来修改，但是有很多东西需要使用模块或主题来进行修改。在Drupal 8中，模块或主题可以使用hook\_block\_view\_alter\(\) 来修改渲染数组，使用hook\_entity\_view\_alter\(\)来修改实体的渲染数组等等。

模块可以定义元素\(渲染元素\)类型，元素类型实际上就是预先将渲染数组打包。定义一个新的渲染类型，需创建一个RenderElement插件，它需实现ElementInterface接口。

### 渲染数组的属性

可以给一个渲染数组添加许多属性，渲染数组的属性将指出要如何渲染数组元素。这里列出一些比较常用的属性。渲染数组的所有属性可以阅读RenderElement API。

| 属性 | 描述 |
| :--- | :--- |
| \#type | 元素的类型。比如表单\(form\)，’submit’等。元素的类型是通过RenderElement插件实现的，可以定义新类型。 |
| \#cache | 将数组标记为可缓存并确定其到期时间等。一旦渲染了给定的渲染数组，直到缓存到期或无效才会再次呈现。使用Cache API。此属性接受以下子属性：\('keys', 'contexts', 'tags', 'max-age', 'bin'\)请参阅缓存性以了解更多信息。设置\#cache正确非常重要！ |
| \#markup | 指定该数组直接提供HTML标记。除非标记非常简单，例如段落标签中的解释，通常最好使用\#theme或\#type，以便主题可以自定义标记。请注意，该值通过\ Drupal \ Component \ Utility \ Xss :: filterAdmin（）传递，它会剥离已知的XSS向量，同时允许不是XSS向量的HTML标签的许可列表。（即，和是不允许的。）&lt;script&gt;&lt;style&gt; |
| \#plain\_text | 指定数组提供需要转义的文本。该值优先于\#markup（如果存在）。 |
| \#prefix/\#suffix | 指出渲染元素的前缀和后缀字符串。 |
| \#pre\_render | 在渲染数组渲染以前，可以使用一个数组函数来修改真正的渲染数组。可以重排渲染数组或是删除一部份，设置\#prointed = TRUE以防止进一步渲染等等。 |
| \#post\_render | 在渲染数组渲染以前，可以使用一个数组函数来修改真正的渲染数组。可以重排渲染数组或是删除一部份，设置\#prointed = TRUE以防止进一步渲染等等。 |
| \#theme | 用来响应渲染数组元素\(包含它的子数组\)的主题函数或者是模板，它预先知道了元素的结构。 |
| \#theme\_wrappers | 一个主题hook的数组，当渲染数组的子数组渲染完成后，它用来添加渲染元素并将其放置到\#children中。典型的应用是给一个子数组添加HTML wrappers，还用于子数组使用它们自已的主题信息的递归渲染过程 |



