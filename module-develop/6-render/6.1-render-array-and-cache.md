# 6.1 渲染数组与缓存

渲染数组决定了向用户显示什么。因此，这个数组也决定了如何缓存一个响应结果。

如果代码动态的产生渲染数组（通常的说，使用了很多if语句），这意味着drupal不能简单地缓存渲染数组中渲染HTML,它需要调用这些代码（所有的if语句）。

换句话说:Drupal需要知道你的动态代码。如果不知道，它可能向不同的用户发送相同的缓存的HTML。



每当您生成一个渲染数组时，需要思考是否对它们进行缓存，请使用以下5个步骤：

1. 我要渲染一些东西。这意味着我必须思考渲染结果的可缓存性。
2. 渲染的东西是否要耗费大量的资源，是否值得缓存?如果答案是”yes”，那么就要考虑使用什么来标识渲染的东西。这些标识符被称为缓存的键\(cache keys\)。
3. 我渲染的结果对权限、每个URL、每种界面语言以及其它是否有不同?这些我们称为缓存上下文\(cache contexts\)。注意缓存上下文是通过设置HTTP的Vary头完成的。
4. 什么会导致我渲染的内容过时?例如，它依赖于哪些东西，如果这些东西改变时，我的渲染又当如何?这些是cache tags。
5. 我渲染的内容什么时候过时?例如，数据是否在有限的时间内有效？那是max-age。它默认为持久缓存\(Cache::PERMANENT\)。当数据只在有限的时间内有效时，请设置max-age，单位为秒。0表示不缓存。



