# 5.1 创建表单

我们将会创建一个表单，可以通过一个菜单路径访问它。这需要创建一个路由以告诉Drupal如何调用表单并向用户显示。

表单使用一个类来定义，它实现了\Drupal\Core\Form\FormInterface接口，\Drupal\Core\Form\FormBase是表单的基类，它定义了很多有用的方法，我们可以扩展这个类来创建一个表单。

1.在模块根目录下创建src目录，在这个目录下，创建Form目录，这个目录用于存放定义表单的类文件。

**  
/modules/custom/hello\_world/src/Form**

2.接下来，创建一个名为ExampleForm.php的文件并把它放在src/Form目录下。Drupal使用PSR4来发现和自动加载类。它要求每个文件只定义一个类，文件名与类名相同。目录结构模拟命名空间。

**  
/modules/custom/hello\_world/src/Form/ExampleForm.php**

3.编辑ExampleForm.php文件并添加合适的命名空间，需使用的类以及类自身。下面是代码结构:

**  
/modules/custom/hello\_world/src/Form/ExampleForm.php**

```php
<?php
namespace Drupal\hello_world\Form;

use Drupal\Core\Form\FormBase;
use Drupal\Core\Form\FormStateInterface;


/**
 * Class ExampleForm
 * @package Drupal\hello_world\Form
 */
class ExampleForm extends FormBase
{

}
```

4.\Drupal\Core\Form\FormBase是一个抽象类，需要我们实现在接口中定义的四个方法:getFormId、buildForm、ValidateForm和submitForm。后面两个方法会单独讲，在这里只是简单地定义。下面是代码:

**  
/modules/custom/hello\_world/src/Form/ExampleForm.php**

```
<?php
namespace Drupal\hello_world\Form;

use Drupal\Core\Form\FormBase;
use Drupal\Core\Form\FormStateInterface;


/**
 * Class ExampleForm
 * @package Drupal\hello_world\Form
 */
class ExampleForm extends FormBase
{
    /**
     * @inheritdoc
     */
    public function getFormId()
    {
        return 'hello_world_example_form';
    }

    /**
     * @inheritdoc
     */
    public function buildForm(array $form, FormStateInterface $form_state)
    {
        // TODO: Implement buildForm() method.
    }

    /**
     * @inheritdoc
     */
    public function validateForm(array &$form, FormStateInterface $form_state)
    {
        parent::validateForm($form, $form_state); // TODO: Change the autogenerated stub
    }

    /**
     * @inheritdoc
     */
    public function submitForm(array &$form, FormStateInterface $form_state)
    {
        // TODO: Implement submitForm() method.
    }
}
```

这段代码充实了前一步的初始类定义。FormBase提供了很多实用的方法，但是它并没有实现接口中的方法。我们把它们定义在这里，因为它们对于每个表单定义都是唯一的。

getFormID方法返回一个唯一的字符串以标识表单，例如，site\_information。你可能会遇到以\_form结尾的表单ID。这并不是必须的，它只不过是以前的Drupal版本中的一种命名规则而已。

下一步将会介绍buildForm方法。至于validateForm和submitForm方法是在表单处理期间调用，将会在后面讲述。

5.调用buildForm方法将会返回表单API元素，它们会渲染给最终用户。我们添加了一个文本输入字段要求用户输入公司名称和一个提交按钮。下面是代码:

**/modules/custom/hello\_world/src/Form/ExampleForm.php**

```php
<?php
namespace Drupal\hello_world\Form;

use Drupal\Core\Form\FormBase;
use Drupal\Core\Form\FormStateInterface;


/**
 * Class ExampleForm
 * @package Drupal\hello_world\Form
 */
class ExampleForm extends FormBase
{
    /**
     * @inheritdoc
     */
    public function getFormId()
    {
        return 'hello_world_example_form';
    }

    /**
     * @inheritdoc
     */
    public function buildForm(array $form, FormStateInterface $form_state)
    {
        $form['company_name'] = array(
            '#type' => 'textfield',
            '#title' => $this->t('Company name'),
        );

        $form['submit'] = array(
            '#type' => 'submit',
            '#value' => $this->t('Save'),
        );
        return $form;
    }

    /**
     * @inheritdoc
     */
    public function validateForm(array &$form, FormStateInterface $form_state)
    {
        parent::validateForm($form, $form_state); // TODO: Change the autogenerated stub
    }

    /**
     * @inheritdoc
     */
    public function submitForm(array &$form, FormStateInterface $form_state)
    {
        // TODO: Implement submitForm() method.
    }
}
```

我们已经将表单元素定义添加到了form数组中。在定义”company\_name”时使用’\#type’键以指定元素类型，使用’\#title’键指出用于界面的标题，使用t\(\)函数表明它是可翻译的。在定义\[‘submit’\]时使用’\#type’定义类型，使用’\#value’定义按钮文本，使用t\(\)表明可翻译。

6.为了能访问这一个表单，我们将会在模块目录下创建一个路由文件\(drupalform.routing.yml\)。在文件中定义一个路由来通知Drupal使用\Drupal\Core\Form\FormBuilder创建和显示我们的表单。代码如下:

```
hello_world.form:
  path: '/hello-example-form'
  defaults:
    _title: 'Example form'
    _form: '\Drupal\hello_world\Form\ExampleForm'
  requirements:
    _access: 'TRUE'
```

7.清空模块缓存\(/admin/config/development/performance\)

8.访问/drupal-example-form，页面显示了一个表单。\(见下图\)

![](/assets/10.png)

演示代码文件

**/modules/custom/hello\_world/hello\_world.routing.yml**

```
hello_world.content:
  path: '/hello'
  defaults:
    _controller: '\Drupal\hello_world\Controller\HelloController::content'
    _title: 'Hello World'
  requirements:
    _permission: 'access content'
hello_world.form:
  path: '/hello-example-form'
  defaults:
    _title: 'Example form'
    _form: '\Drupal\hello_world\Form\ExampleForm'
  requirements:
    _access: 'TRUE'
```

**/modules/custom/hello\_world/src/Form/ExampleForm.php**

```php
<?php
namespace Drupal\hello_world\Form;

use Drupal\Core\Form\FormBase;
use Drupal\Core\Form\FormStateInterface;


/**
 * Class ExampleForm
 * @package Drupal\hello_world\Form
 */
class ExampleForm extends FormBase
{
    /**
     * @inheritdoc
     */
    public function getFormId()
    {
        return 'hello_world_example_form';
    }

    /**
     * @inheritdoc
     */
    public function buildForm(array $form, FormStateInterface $form_state)
    {
        $form['company_name'] = array(
            '#type' => 'textfield',
            '#title' => $this->t('Company name'),
        );

        $form['submit'] = array(
            '#type' => 'submit',
            '#value' => $this->t('Save'),
        );
        return $form;
    }

    /**
     * @inheritdoc
     */
    public function validateForm(array &$form, FormStateInterface $form_state)
    {
        parent::validateForm($form, $form_state); // TODO: Change the autogenerated stub
    }

    /**
     * @inheritdoc
     */
    public function submitForm(array &$form, FormStateInterface $form_state)
    {
        // TODO: Implement submitForm() method.
    }
}
```



